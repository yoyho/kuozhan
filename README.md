# Telegram 档案管理器 (telegram-file-manager)

一个功能强大且灵活的网页档案管理器。它使用 Express 和 Node.js 构建，并提供可插拔的储存后端，您可以选择将档案安全地储存在 **Telegram 频道**或**本地伺服器**上。

本专案从一个简单的工具演变而来，现在已具备完整的多使用者权限管理、丰富的档案操作介面和系统管理功能，适合作为个人云端硬碟或小型团队的档案协作平台。

## ✨ 特色功能

#### 👨‍👩‍👧‍👦 完整的使用者系统

* **管理员与普通使用者**：系统地区分管理员和普通使用者权限。
* **使用者注册**：开放使用者注册功能，每位使用者拥有独立的储存空间。
* **帐号管理**：使用者可自行修改密码（需验证旧密码）；管理员拥有一键新增、修改密码、删除普通使用者的权限。进行方式：https://yourdomain/admin。
* **安全隔离**：每个使用者的档案和资料夹都是完全隔离的，确保了资料的私密性。

#### 🗄️ 灵活的储存后端

* **Telegram 储存**：利用 Telegram 的无限容量，将您的档案作为讯息安全地储存在指定的频道中。
* **本地伺服器储存**：直接将档案储存在运行伺服器的 `data/uploads` 目录下，按使用者 ID 自动分资料夹存放。
* **一键切换**：管理员可在管理后台页面随时切换储存模式，以适应不同需求。

#### 📂 强大的档案管理

* **全功能操作**：支援档案和资料夹的建立、上传、下载、重新命名、移动和删除。
* **拖拽上传**：支援拖拽多个档案直接上传到目前目录，并附有进度条显示。
* **智慧型检查**：在上传和移动时，会自动进行同名档案检查，并提示使用者是否覆盖。
* **打包下载**：支援多选档案和资料夹，一键打包为 `.zip` 档案下载。

#### 📝 线上编辑与预览

* **文字档案编辑器**：直接在网页上建立 (`.txt`) 或编辑现有文字档案，支援即时储存并可随时返回。
* **线上预览**：支援图片、影片、纯文字等多种类型档案的线上预览。
* **影片缩图**：无论使用 Telegram 还是本地储存，影片档案都能在列表中正确显示缩图。

#### 🔗 安全的档案分享

* **连结分享**：可为单一档案建立有时效性（如 1 小时、1 天、永久）或永久的公开分享连结。
* **分享管理**：在「管理共享」页面，可以查看所有正在分享的档案并随时取消分享。
* **纯文字直接显示**：分享的纯文字档案会直接在页面中以阅读模式显示，而非预览框。

## 🚀 安装与设定

在开始之前，请确保您的系统已安装 `Git` 和 `Node.js` (v16+)。

#### 1. 一键安装脚本

打开您的 Linux 或 macOS 终端机，执行以下任一命令即可下载并安装基础依赖：

**使用 `curl` (推荐):**
```bash
bash -c "$(curl -fsSL https://raw.githubusercontent.com/Limkon/telegram-file-manager/master/install.sh)"
 ```
#### 2. 设定环境变数
安装脚本执行完毕后，您需要在专案根目录下手动建立一个名为 .env 的档案，并填入以下内容：

**必填：从 @BotFather 取得您的 Telegram Bot Token
BOT_TOKEN=your_bot_token_here

** 必填：您的 Telegram 频道的 ID (必须为私有频道，并将 Bot 设为管理员)
CHANNEL_ID=your_channel_id_here

**必填：设定网站的初始管理员帐号
ADMIN_USER=admin
ADMIN_PASS=your_admin_password

**必填：用于加密 Session 的随机密钥，请换成一个复杂的随机字串
SESSION_SECRET=a8e2a32e9b1c7d5f6a7b3c4d5e8f1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f

#### 3.刪除舊的管理員帳號

** 您需要一個 SQLite 資料庫編輯工具來操作 data/file-manager.db 這個檔案。

** 如果您熟悉命令列，可以在專案根目錄下執行 sqlite3 data/file-manager.db 來進入資料庫。

** 如果您希望使用圖形化介面，推薦下載並安裝 DB Browser for SQLite，然後用它打開 data/file-manager.db 檔案。

** 無論使用哪種工具，請執行以下 SQL 指令來刪除所有被標記為管理員的用戶：

** SQL

** DELETE FROM users WHERE is_admin = 1;
